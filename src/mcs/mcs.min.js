/**
* Copyright (c) 2017, Oracle and/or its affiliates. All rights reserved.
 * Oracle Mobile Cloud Service JavaScript SDK for Browsers, Release: 16.4.5.0, E76062-04
*/


!function(a){"use strict";function b(a,b,c){this.statusCode=a,this.data=b,this.headers=c}function c(a,b){this.statusCode=a,this.storageObject=b}function d(){this.logLevel=M.INFO}function e(a){return a.replace(/ /g,"")}function f(){this.HEADERS=P,this.RESOURCE_TYPES=S,this.HTTP_METHODS=R,this.ACCEPT_TYPES=Q,this.AUTHENTICATION_TYPES=T}function g(a,b){var c=b.uuid();this._deviceState=L.unrestricted,this._deviceStateChangedCallbacks=[],this.getDeviceId=function(){return c},this.setDeviceState=function(b){if(this._deviceState!=b){a.info("Device state changing from "+this._deviceState+" to "+b),this._deviceState=b;for(var c=0;c<this._deviceStateChangedCallbacks.length;c++)this._deviceStateChangedCallbacks[c](this._deviceState)}}}function h(a,c,d){a=a||W.mobileBackendManager,d=d||W._utils,c=c||W._logger;var e=/\?/;g.call(this,c,d),this.isBrowser=!0,this.isCordova=!1,this.invokeService=function(f){function g(e,g){var i=new XMLHttpRequest;i.open(f.method,h);for(var j in f.headers)f.headers.hasOwnProperty(j)&&i.setRequestHeader(j,f.headers[j]);if(i.withCredentials=!0,i.responseType=f.responseType||"json",i.onreadystatechange=function(){if(4===i.readyState){var h=""==i.responseType||"text"==i.responseType?i.responseText:i.response,j=i.responseHeaders||d.parseHeaders(i.getAllResponseHeaders()),k=new b(i.status,h,j);if(a._config.logHTTP){var l={headers:j,body:h};c.verbose("Received "+f.method+" response from "+f.url,l)}i.status>=200&&i.status<=299?e(k):g(k)}},i.send(f.data),a._config.logHTTP){var k={headers:f.headers,body:f.body};c.verbose("Sent "+f.method+" request to "+f.url,k)}}var h=f.url;return this.isBrowser&&(h=h+(e.test(h)?"&":"?")+"_="+(new Date).getTime()),new Promise(g)}}function i(a){this.name=a,this.timestamp=(new Date).toISOString(),this.sessionID=null,delete this.sessionID,this.properties={}}function j(a,c,d,e){var f=null,g=[];this.getSessionId=function(){return f},this._getEvents=function(){return g},this.startSession=function(){null==f&&(f=d.uuid(),this.logNamedEvent("sessionStart").type="system")},this.endSession=function(a,c){function d(){f=null,a&&a()}function g(a){return c?void c(a.statusCode,a.data):Promise.reject(a)}if(null!=f){var h=this;return h.logNamedEvent("sessionEnd").type="system",e.verbose("Deactivate a default session"),this.flush().then(d,g)}return c?void c(500,"Session ID is null"):Promise.reject(new b(500,"Session ID is null"))},this.logNamedEvent=function(a){var b=new i(a);return this.logEvent(b),b},this.logEvent=function(a){return 0==g.length&&(g[0]=this._createContextEvent()),this.startSession(),g[g.length]=a,a.sessionID=f,a},this.flush=function(b,f){function h(){e.verbose("Analytics events flushed."),g=[],b&&b()}function i(a){return e.error("Failed to flush analytics events."),f?void f(a.statusCode,a.data):Promise.reject(a)}for(var j=0;j<g.length;j++)if("context"==g[j].name){var k=c.getGPSLocation();null!=k&&null!=k.latitude&&(g[j].properties.latitude=k.latitude),null!=k&&null!=k.longitude&&(g[j].properties.longitude=k.longitude)}var l=JSON.stringify(g),m=a.getHttpHeaders();return m[d.HEADERS.CONTENT_TYPE]=d.ACCEPT_TYPES.APPLICATION_JSON,c.invokeService({method:d.HTTP_METHODS.POST,url:a.getPlatformUrl("analytics/events"),headers:m,data:l}).then(h,i)},this._createContextEvent=function(){var a=new i("context");a.type="system",a.properties.timezone=""+60*(new Date).getTimezoneOffset();var b=c.getDeviceInformation();return a.properties.model=b.model,a.properties.manufacturer=b.manufacturer,a.properties.osName=b.osName,a.properties.osVersion=b.osVersion,a.properties.osBuild=b.osBuild,a.properties.carrier=b.carrier,a}}function k(a,b,c,d,e){if(this.constructor===k)throw new Error("Can't instantiate abstract class!");var f=c.HEADERS,g=null,h=c.validateConfiguration(b),i=!1,j=!1,l=null;Object.defineProperty(this,"isAuthorized",{get:function(){return j}}),this.getAccessToken=function(){return g},this._setAccessToken=function(a){g=a},this._getApplicationKey=function(){return h},this._getIsAnonymous=function(){return i},this._getIsAuthorized=function(){return j},this._getAnonymousAccessToken=function(){return l},this._authenticateAnonymousInvoke=function(a,b,c,g,i){function j(a){return e.error("Login failed with error: "+a.statusCode),k._clearState(),Promise.reject(a)}var k=this;return this.logout(),b[f.AUTHORIZATION]=a,b[f.ORACLE_MOBILE_APPLICATION_KEY]=h,d.invokeService({url:c,method:g,headers:b,data:i}).then(function(b){return{orgResponse:b,authorizationToken:a}}).then(k._anonymousTokenResponseConverter,j).then(k._authenticateAnonymousSuccess)},this._authenticateAnonymousSuccess=function(a){return e.info("User logged in anonymously "+a.orgResponse.statusCode),i=!0,j=!0,l=a.anonymousAccessToken,a.orgResponse},this._authenticateSuccess=function(a,b){e.info("User logged in "+a.statusCode),i=!1,j=!0,g=b},this._authenticateError=function(a){e.error("Login failed with error: "+a.statusCode),this._clearState()},this._clearState=function(){g=null,i=!1,l=null,j=!1},this.getCurrentUser=function(b,c){function e(a){var c=new q(a.data);return null!=c.links&&delete c.links,b&&"function"==typeof b&&b(a.statusCode,c),{statusCode:a.statusCode,user:c}}function f(a){return c&&"function"==typeof c?void c(a.statusCode,a.data):Promise.reject(a)}return d.invokeService({method:"GET",url:a.getPlatformUrl("users/~"),headers:a.getHttpHeaders({})}).then(e,f)}}function l(a,c,d,e,f,g){k.call(this,c,d,e,f,g);var h=e.HEADERS,i=e.validateConfiguration(a.backendId),j=e.validateConfiguration(a.anonymousToken),l=null,m=this;this.getAuthorizedUserName=function(){return l},this.authenticate=function(a,d,j,k){function n(b){return m._authenticateSuccess(b,p),l=a,j&&j(b.statusCode,b.data),b}function o(a){return m._authenticateError(a),k?void k(a.statusCode,a.data):Promise.reject(a)}if(this.logout(),!a||!d)return g.error("Wrong username or password parameter"),k?void k(400,"Bad Request"):Promise.reject(new b(400,"Bad Request"));var p="Basic "+e.encodeBase64(a+":"+d),q={};return q[h.AUTHORIZATION]=p,q[h.ORACLE_MOBILE_BACKEND_ID]=i,q[h.ORACLE_MOBILE_APPLICATION_KEY]=m._getApplicationKey(),f.invokeService({url:c.getPlatformUrl("users/login"),method:e.HTTP_METHODS.GET,headers:q}).then(n,o)},this.authenticateAnonymous=function(a,b){function d(b){return a&&a(b.statusCode,b.data),b}function f(a){return b?void b(a.statusCode,a.data):Promise.reject(a)}var g="Basic "+j,k={};return k[h.ORACLE_MOBILE_BACKEND_ID]=i,this._authenticateAnonymousInvoke(g,k,c.getPlatformUrl("users/login"),e.HTTP_METHODS.GET).then(d,f)},this._anonymousTokenResponseConverter=function(a){return{orgResponse:a.orgResponse,anonymousAccessToken:a.authorizationToken}},this.isTokenValid=function(){return null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()?(g.info("Authorization token is not null or empty"),!0):null==this.getAccessToken()&&"string"!=typeof this.getAccessToken()?(g.info("Authorization token is null and/or empty"),!1):void 0},this.refreshToken=function(a,c){return this._getIsAuthorized()||this.isTokenValid()?this._getIsAuthorized()&&this.isTokenValid()?(g.error("Authenticated token is valid, you do not need to refresh."),a&&"function"==typeof a&&a(200,this.getAccessToken()),Promise.resolve(new b(200,this.getAccessToken()))):void 0:c&&"function"==typeof c?void c(401,"Please use the authenticate with username/password combination or authenticateAnonymous function before using refreshToken."):Promise.reject(new b(401,"Please use the authenticate with username/password combination or authenticateAnonymous function before using refreshToken."))},this.logout=function(){this._clearState()},this._getHttpHeaders=function(a){null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()&&(a[h.AUTHORIZATION]=this.getAccessToken()),a[h.ORACLE_MOBILE_BACKEND_ID]=i,a[h.ORACLE_MOBILE_APPLICATION_KEY]=m._getApplicationKey()},this._getAnonymousHttpHeaders=function(a){this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&(a[h.AUTHORIZATION]=this._getAnonymousAccessToken()),a[h.ORACLE_MOBILE_BACKEND_ID]=i,a[h.ORACLE_MOBILE_APPLICATION_KEY]=m._getApplicationKey()};var n=this._clearState;this._clearState=function(){n.call(this),l=null}}function m(a,c,d,e,f,g){function h(a,b){var c,d;return c=a.indexOf("@")>-1?encodeURIComponent(a).replace(/%20/g,"+"):encodeURIComponent(a).replace(/%5B/g,"[").replace(/%5D/g,"]"),d=b.indexOf("&")>-1?encodeURIComponent(b).replace(/%20/g,"+"):encodeURIComponent(b).replace(/%5B/g,"[").replace(/%5D/g,"]"),"grant_type=password&username="+c+"&password="+d}k.call(this,c,d,e,f,g);var i=e.HEADERS,j=e.validateConfiguration(a.clientId),l=e.validateConfiguration(a.clientSecret);if(a.hasOwnProperty("userIdentityDomainName"))var m=e.validateConfiguration(a.userIdentityDomainName);var n=null,o=null,p=this;this.getAuthorizedUserName=function(){return o},this.getClientId=function(){return j},this.getTenantName=function(){return m},this.getClientSecret=function(){return l},this.authenticate=function(a,d,j,k){function l(b){return p._authenticateSuccess(b,b.data.access_token),o=a,j&&j(b.statusCode,b.data),b}function m(a){return p._authenticateError(a),k?void k(a.statusCode,a.data):Promise.reject(a)}if(this.logout(),!a||!d)return g.error("Wrong username or password parameter"),k?void k(400,"Bad Request"):Promise.reject(new b(400,"Bad Request"));var n="Basic "+e.encodeBase64(this.getClientId()+":"+this.getClientSecret()),q=h(a,d),r={};return r[i.CONTENT_TYPE]="application/x-www-form-urlencoded; charset=utf-8",r[i.AUTHORIZATION]=n,r[i.ORACLE_MOBILE_APPLICATION_KEY]=this._getApplicationKey(),"undefined"!=typeof p.getTenantName()&&(r[i.X_USER_IDENTITY_DOMAIN_NAME]=p.getTenantName()),f.invokeService({url:c.getOAuthTokenUrl(),method:e.HTTP_METHODS.POST,headers:r,data:q}).then(l,m)},this.authenticateAnonymous=function(a,b){function d(b){return n=Date.now()+1e3*b.data.expires_in,a&&a(b.statusCode,b.data),b}function f(a){return b?void b(a.statusCode,a.data):Promise.reject(a)}var g="Basic "+e.encodeBase64(this.getClientId()+":"+this.getClientSecret()),h={};return h[i.CONTENT_TYPE]="application/x-www-form-urlencoded; charset=utf-8","undefined"!=typeof p.getTenantName()&&(h[i.X_USER_IDENTITY_DOMAIN_NAME]=this.getTenantName()),this._authenticateAnonymousInvoke(g,h,c.getOAuthTokenUrl(),e.HTTP_METHODS.POST,"grant_type=client_credentials").then(d,f)},this._anonymousTokenResponseConverter=function(a){return{orgResponse:a.orgResponse,anonymousAccessToken:a.orgResponse.data.access_token}},this.isTokenValid=function(){if(this.getAccessToken()||this._getAnonymousAccessToken()){g.verbose("Token is not null or empty");var a=Date.now();return a>=n?(g.info("Token has expired"),!1):(g.verbose("Token is still valid"),!0)}return!1},this.logout=function(){this._clearState()},this.refreshToken=function(a,c){var d=this.isTokenValid();return d&&!this.getAccessToken()&&this._getIsAnonymous()?(a&&(g.error("Anonymous token is valid, you do not need to refresh."),a(200,this._getAnonymousAccessToken())),Promise.resolve(new b(200,this._getAnonymousAccessToken()))):!d||this._getAnonymousAccessToken()||this._getIsAnonymous()?(g.error("Token has expired or user has not been authenticate with the service."),c&&c(401,"Please use the authenticate with username/password combination or authenticateAnonymous function before using refreshToken."),Promise.resolve(new b(401,"Please use the authenticate with username/password combination or authenticateAnonymous function before using refreshToken."))):(a&&(g.error("Authenticated token is valid, you do not need to refresh."),a(200,this.getAccessToken())),Promise.resolve(new b(200,this._getAnonymousAccessToken())))};var q=this._clearState;this._clearState=function(){q.call(this),o=null,n=1e3*Date.now()},this._getHttpHeaders=function(a){null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()&&(a[i.AUTHORIZATION]="Bearer "+this.getAccessToken()),a[i.ORACLE_MOBILE_APPLICATION_KEY]=this._getApplicationKey()},this._getAnonymousHttpHeaders=function(a){this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&(a[i.AUTHORIZATION]="Bearer "+this._getAnonymousAccessToken()),a[i.ORACLE_MOBILE_APPLICATION_KEY]=this._getApplicationKey()}}function n(a,c,d,e,f,g){function h(a,c){function d(a,c){var d=o.getFacebookAppId(),e="http://localhost/callback",f="https://www.facebook.com/dialog/oauth?client_id="+d+"&redirect_uri="+e+"&response_type=token&scope=public_profile",h=window.open(f,"_blank","location=no,clearsessioncache=yes,clearcache=yes");h.show(),g.info("Opening InAppBrowser to url: "+f),h.addEventListener("loadstart",function(d){if(0===d.url.indexOf(e)){h.close();for(var f=d.url.split("#")[1],g=f.split("&"),i={},j=0;j<g.length;j++)i[g[j].split("=")[0]]=g[j].split("=")[1];i.access_token?(n=Date.now()+1e3*i.expires_in,a(new b(200,i))):0===d.url.indexOf("error_code=100")||o.isAuthorized||c(new b(100,"Cannot authenticate via a web browser"))}}),h.addEventListener("exit",function(){o._getIsAuthorized()||c(new b(100,"Cannot authenticate via a web browser"))})}function e(b){return o._authenticateSuccess(b,b.data.access_token),n=Date.now()+1e3*b.data.expires_in,a&&a(b.statusCode,b.data),b}function f(a){return o._authenticateError(a),c?void c(a.statusCode,a.data):Promise.reject(a)}return new Promise(d).then(e).catch(f)}var i=e.HEADERS;k.call(this,c,d,e,f,g);var j=e.validateConfiguration(a.backendId),l=e.validateConfiguration(a.anonymousToken),m=e.validateConfiguration(a.facebookAppId),n=null,o=this;this.getFacebookAppId=function(){return m},this.authenticate=function(a,c){if(this.logout(),window.cordova){var d=cordova.require("cordova/plugin_list").metadata;return U(d)!==!0?null!=c?void c(100,'Could not find InAppBrowser plugin, use command "cordova plugin add cordova-plugin-inappbrowser"'):Promise.reject(new b(100,'Could not find InAppBrowser plugin, use command "cordova plugin add cordova-plugin-inappbrowser"')):h(a,c)}return null!=c?void c(400,"Bad Request - This method require Cordova framework"):Promise.reject(new b(400,"Bad Request - This method require Cordova framework"))},this.authenticateAnonymous=function(a,b){function d(b){return a&&a(b.statusCode,b.data),b}function f(a){return b?void b(a.statusCode,a.data):Promise.reject(a)}var g="Basic "+l,h={};return h[i.ORACLE_MOBILE_BACKEND_ID]=j,this._authenticateAnonymousInvoke(g,h,c.getPlatformUrl("users/login"),e.HTTP_METHODS.GET).then(d,f)},this._anonymousTokenResponseConverter=function(a){return{orgResponse:a.orgResponse,anonymousAccessToken:a.authorizationToken}},this.isTokenValid=function(){if(this.getAccessToken()||this._getAnonymousAccessToken()){g.verbose("Token is not null or empty");var a=Date.now();return a>=n?(g.info("Token has expired or user has not been authenticate with the service/Facebook"),!1):(g.verbose("Token is still valid"),!0)}return!1},this.refreshToken=function(a,c){var d=o.isTokenValid();return d&&null==this.getAccessToken()&&this._getIsAnonymous()?(a&&(g.error("Anonymous token is valid, you do not need to refresh."),a(200,this._getAnonymousAccessToken())),Promise.resolve(new b(200,this._getAnonymousAccessToken()))):d&&this._getAnonymousAccessToken()&&!this._getIsAnonymous()?(a&&(g.error("Authenticated token is valid, you do not need to refresh."),a(200,this.getAccessToken())),Promise.resolve(new b(200,this._getAnonymousAccessToken()))):(g.error("Token is not valid and has expired, refreshing token from Facebook."),this.authenticate(a,c))},this.logout=function(){this._clearState(),n=1e3*Date.now()},this._getHttpHeaders=function(a){null!=this.getAccessToken()&&"string"==typeof this.getAccessToken()&&(a[i.AUTHORIZATION]="Basic "+l,a[i.ORACLE_MOBILE_SOCIAL_ACCESS_TOKEN]=this.getAccessToken(),a[i.ORACLE_MOBILE_SOCIAL_IDENTITY_PROVIDER]="facebook"),a[i.ORACLE_MOBILE_BACKEND_ID]=j,a[i.ORACLE_MOBILE_APPLICATION_KEY]=this._getApplicationKey()},this._getAnonymousHttpHeaders=function(a){this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&(a[i.AUTHORIZATION]=this._getAnonymousAccessToken()),a[i.ORACLE_MOBILE_BACKEND_ID]=j,a[i.ORACLE_MOBILE_APPLICATION_KEY]=this._getApplicationKey()}}function o(a,c,d,e,f,g){function h(a,d){function f(a,d){var f={},h=s.getClientId(),i=c.getPlatformUrl("sso/token")+"?clientID="+h+"&format=json",j=window.open(i,"_blank","location=no,clearsessioncache=yes,clearcache=yes");j.show(),g.info("Opening InAppBrowser to url: "+i),p={},j.addEventListener("loadstop",function(c){var g=l(c.url);p[g]||(p[g]=!0),e.isEquivalentURL(c.url,i)&&(console.log("Domains object:",p),j.executeScript({code:"document.body.innerHTML"},function(c){j.close();var e=c[0],g=e.indexOf("{"),h=e.lastIndexOf("}")+1,i=e.substring(g,h);f=JSON.parse(i),void 0!==f.access_token&&null!==f.access_token?a(new b(200,f)):d(s._getIsAuthorized()!==!0&&f.status>=401?new b(100,"Cannot authenticate via a web browser"):new b(f.status,f))}))}),j.addEventListener("exit",function(){(s._getIsAuthorized()!==!0||f.status)&&d(new b(100,"Cannot authenticate via a web browser"))})}function h(b){return s._authenticateSuccess(b,b.data.access_token),r=Date.now()+1e3*b.data.expires_in,a&&a(b.statusCode,b.data),b}function i(a){return s._authenticateError(a),d?void d(a.statusCode,a.data):Promise.reject(a)}return new Promise(f).then(h,i)}function i(a,b){function c(c){console.log("Cookie "+b+" set successful for domain:"+a,c)}function d(){}cordova.plugins.MCSCookies.set(a,b,"",c,d)}function j(a){function b(b){console.log("Cookies removed successful for domain:"+a,b)}function c(){}cordova.plugins.MCSCookies.remove(a,"^(?!OAM_PREFS)(OAM.*)|^ORA_OSFS_SESSION$",b,c)}function l(a){var b;return b=a.indexOf("://")>-1?a.split("/")[2]:a.split("/")[0],b=b.split(":")[0]}var m=e.HEADERS;k.call(this,c,d,e,f,g);var n=e.validateConfiguration(a.clientId),o=e.validateConfiguration(a.clientSecret),p={};if(a.hasOwnProperty("userIdentityDomainName"))var q=e.validateConfiguration(a.userIdentityDomainName);var r=null,s=this;this.getClientId=function(){return n},this.getTenantName=function(){return q},this.getClientSecret=function(){return o},this.authenticate=function(a,c){if(this.logout(),window.cordova){var d=cordova.require("cordova/plugin_list").metadata;return t(d)!==!0?null!=c?void c(100,'Could not find InAppBrowser, use command "cordova plugin add cordova-plugin-inappbrowser"'):Promise.reject(new b(100,'Could not find InAppBrowser, use command "cordova plugin add cordova-plugin-inappbrowser"')):d.hasOwnProperty("oracle-mobile-cloud-cookies")?h(a,c):null!=c?void c(100,'Could not find oracle-mobile-cloud-cookies plugin, use command "cordova plugin add {path to oracle plugin}oracle-mobile-cloud-cookies"'):Promise.reject(new b(100,'Could not find oracle-mobile-cloud-cookies plugin, use command "cordova plugin add {path to oracle plugin}oracle-mobile-cloud-cookies"'))}return null!=c?void c(400,"Bad Request - This method require Cordova framework"):Promise.reject(400,"Bad Request - This method require Cordova framework")},this.authenticateAnonymous=function(a,b){function d(b){return r=Date.now()+1e3*b.data.expires_in,a&&a(b.statusCode,b.data),b}function f(a){return b?void b(a.statusCode,a.data):Promise.reject(a)}var g="Basic "+e.encodeBase64(this.getClientId()+":"+this.getClientSecret()),h={};return h[m.CONTENT_TYPE]="application/x-www-form-urlencoded; charset=utf-8","undefined"!=typeof this.getTenantName()&&(h[m.X_USER_IDENTITY_DOMAIN_NAME]=this.getTenantName()),this._authenticateAnonymousInvoke(g,h,c.getSSOAuthTokenUrl(),e.HTTP_METHODS.POST,"grant_type=client_credentials").then(d,f)},this._anonymousTokenResponseConverter=function(a){return{orgResponse:a.orgResponse,anonymousAccessToken:a.orgResponse.data.access_token}};var t=function(a){var b=["cordova-plugin-inappbrowser","org.apache.cordova.inappbrowser"];return b.some(function(b){return a.hasOwnProperty(b)})},u=function(){var a=cordova.require("cordova/plugin_list").metadata;if(!a.hasOwnProperty("oracle-mobile-cloud-cookies"))return void g.error('Could not find oracle-mobile-cloud-cookies plugin, use command "cordova plugin add {path to oracle plugin}oracle-mobile-cloud-cookies"');var b=c.getPlatformUrl("sso/token"),d=l(b),e="OAMAuthnCookie_"+(0===b.indexOf("https")?"https":"http");i(d,e),e="OAMAuthnCookie_"+d,b.indexOf("443")>=0&&(e+=":443"),i(d,e);for(var f in p)p.hasOwnProperty(f)&&j(f)};this.isTokenValid=function(){if(this.getAccessToken()||this._getAnonymousAccessToken()){g.verbose("Token is not null or empty");var a=Date.now();return a>=r?(g.info("Token has expired or user has not been authenticate with the service"),!1):(g.verbose("Token is still valid"),!0)}return!1},this.logout=function(){this._clearState(),r=1e3*Date.now(),u()},this.refreshToken=function(a,b){var c=s.isTokenValid();c!==!1?(null==this.getAccessToken()&&this._getIsAnonymous()&&a&&(g.error("Anonymous token is valid, you do not need to refresh."),a(200,this._getAnonymousAccessToken())),this._getAnonymousAccessToken()||this._getIsAnonymous()||a&&(g.error("Authenticated token is valid, you do not need to refresh."),a(200,this.getAccessToken()))):(g.error("Token is not valid and has expired, refreshing token from service."),this.authenticate(a,b))},this._getHttpHeaders=function(a){null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()&&(a[m.AUTHORIZATION]="Bearer "+this.getAccessToken()),a[m.ORACLE_MOBILE_APPLICATION_KEY]=this._getApplicationKey()},this._getAnonymousHttpHeaders=function(a){this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&(a[m.AUTHORIZATION]="Bearer "+this._getAnonymousAccessToken()),a[m.ORACLE_MOBILE_APPLICATION_KEY]=this._getApplicationKey()}}function p(a,c,d,e,f,g){k.call(this,c,d,e,f,g);var h=e.HEADERS,i=e.validateConfiguration(a.backendId),j=this,l=null,m=null;this.authenticate=function(a){function d(a){if(a.data.access_token.indexOf(".")>=0){var c=a.data.access_token.split("."),d=JSON.parse(atob(c[1]));l=new Date(d.exp)}else{var e=j._inflate(a.data.access_token),f=j._getXmlTokenExpiryDate(e);l=j._parseDate(f)}return j._authenticateSuccess(a,a.data.access_token),new b(200,a.data)}function k(a){return j._authenticateError(a),Promise.reject(a)}if(this.logout(),m=a,!a)return g.error("Wrong token parameter"),Promise.reject(new b(400,"Bad Request"));if(!pako)return g.error("Pako library is not installed."),Promise.reject(new b(400,"Pako library is not installed."));var n="Bearer "+a,o=c.getHttpHeaders();return o[h.AUTHORIZATION]=n,o[h.ORACLE_MOBILE_BACKEND_ID]=i,o[h.ORACLE_MOBILE_APPLICATION_KEY]=j._appKey,f.invokeService({url:c.getPlatformUrl("sso/exchange-token?format=json"),method:e.HTTP_METHODS.GET,headers:o}).then(d).catch(k)},this.authenticateAnonymous=function(){function a(a){return l=Date.now()+1e3*a.data.expires_in,a}var b="Basic "+e.encodeBase64(j.getClientId()+":"+j.getClientSecret()),d={};return d[h.CONTENT_TYPE]="application/x-www-form-urlencoded; charset=utf-8","undefined"!=typeof j.getTenantName()&&(d[h.X_USER_IDENTITY_DOMAIN_NAME]=j.getTenantName()),j._authenticateAnonymousInvoke(b,d,c.getSSOAuthTokenUrl(),e.HTTP_METHODS.POST,"grant_type=client_credentials").then(a)},this.isTokenValid=function(){if(this.getAccessToken()||this._getAnonymousAccessToken()){g.verbose("Token is not null or empty");var a=Date.now();return a>=l?(g.info("Token has expired or user has not been authenticate with the service"),!1):(g.verbose("Token is still valid"),!0)}return!1},this.logout=function(){m=null,this._clearState()},this.refreshToken=function(){var a=j.isTokenValid();return a===!1?(g.error("Token is not valid and has expired, refreshing token from service.",m),j.authenticate(m).then(function(){return j._accessToken})):null==j._accessToken&&j._isAnonymous?(g.error("Anonymous token is valid, you do not need to refresh."),Promise.resolve(j._anonymousAccessToken)):j._anonymousAccessToken||j._isAnonymous?void 0:(g.error("Authenticated token is valid, you do not need to refresh."),Promise.resolve(j._accessToken))},this._getHttpHeaders=function(a){null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()&&(a[h.AUTHORIZATION]="Bearer "+this.getAccessToken()),a[h.ORACLE_MOBILE_APPLICATION_KEY]=this._getApplicationKey()},this._getAnonymousHttpHeaders=function(a){this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&(a[h.AUTHORIZATION]="Bearer "+this._getAnonymousAccessToken()),a[h.ORACLE_MOBILE_APPLICATION_KEY]=this._getApplicationKey()}}function q(a){var b=a.id,c=a.username,d=a.firstName,e=a.lastName,f=a.email,g={};for(var h in a)["id","username","firstName","lastName","email"].indexOf(h)<0&&(g[h]=a[h]),null!=g.links&&delete g.links;this.getId=function(){return b},this.getUsername=function(){return c},this.setUsername=function(a){c=a},this.getProperties=function(){return g},this.setProperties=function(a,b){var c=this.getProperties(),d=a.split(/\./);d.length<2?c[d[0]]=b:(c[d[0]]||(c[d[0]]={}),c=c[d.shift()],this.setProperties(d.join("."),b))},this.getFirstName=function(){return d},this.setFirstName=function(a){d=a},this.getLastName=function(){return e},this.setLastName=function(a){e=a},this.getEmail=function(){return f},this.setEmail=function(a){f=a}}function r(a,b){var c=b.HEADERS,d=b.uuid();this._getHttpHeaders=function(b){b[c.ORACLE_MOBILE_DIAGNOSTIC_SESSION_ID]=this.getSessionId(),b[c.ORACLE_MOBILE_DEVICE_ID]=a.getDeviceId(),b[c.ORACLE_MOBILE_CLIENT_REQUEST_TIME]=(new Date).toISOString()},this.getSessionId=function(){return d}}function s(a,c,d){var e={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},f=a;this.invokeCustomCodeJSONRequest=function(a,g,h,i,j){function k(a){return i&&i(a.statusCode,a.data,a.headers),a}function l(a){return j?void j(a.statusCode,a.data):Promise.reject(a)}if(g in e){if(g===e.DELETE&&h)return null!=j?void j(500,"DELETE method content body"):Promise.reject(new b(500,"DELETE method content body"));var m=f.getHttpHeaders();m[c.HEADERS.CONTENT_TYPE]="application/json";var n=h?JSON.stringify(h):null;return d.invokeService({method:g,url:f.getCustomCodeUrl(a),headers:m,data:n}).then(k,l)}return null!=j?void j(501,"Method Not Implemented"):Promise.reject(new b(501,"Method Not Implemented"))}}function t(a,b,c,d,e,f,g){function h(a,b){return a.match(b+"$")==b}var i=this,k=e.AUTHENTICATION_TYPES,q="mobile/platform",t="mobile/custom";this._config=c,this._baseUrl=e.validateConfiguration(this._config.baseUrl);var u=null;this._getCustomCodeUri=function(a){var b="/"+t;return h(a,"/")&&(a=a.slice(0,-1)),b+"/"+a},this.name=b,this.authorization=null,Object.defineProperty(this,"Authorization",{get:function(){return i.authorization}}),this.diagnostics=new r(d,e),Object.defineProperty(this,"Diagnostics",{get:function(){return i.diagnostics}}),this.customCode=new s(this,e,d),Object.defineProperty(this,"CustomCode",{get:function(){return i.customCode}}),this.analytics=new j(this,d,e,f),Object.defineProperty(this,"Analytics",{get:function(){return i.analytics}}),this.storage=new x(this,e,d,f),Object.defineProperty(this,"Storage",{get:function(){return i.storage}}),g&&(Object.defineProperty(this,"Synchronization",{get:function(){return i.synchronization}}),this.synchronization=new z(a,this,this._config.synchronization,e,d,g)),y&&(this.notifications=new y(this,e,d,f),Object.defineProperty(this,"Notifications",{get:function(){return i.notifications}})),this.appConfig={},Object.defineProperty(this,"AppConfig",{get:function(){return i.appConfig}}),this.getPlatformUrl=function(a){var b=i._config.baseUrl;return"ssoAuth"==u&&h(i._config.baseUrl,"1")&&(b=b.substring(0,b.length-4)+"7777"),b=e.validateConfiguration(b)+"/"+q,h(b,"/")||(b+="/"),b+a},this.getCustomCodeUrl=function(a){return e.validateConfiguration(i._config.baseUrl)+i._getCustomCodeUri(a)},this.getOAuthTokenUrl=function(){var a=e.validateConfiguration(this._config.authorization.oAuth.tokenEndpoint);return h(a,"/")||(a+="/"),a},this.getSSOAuthTokenUrl=function(){var a=e.validateConfiguration(i._config.authorization.ssoAuth.tokenEndpoint);return h(a,"/")||(a+="/"),a},this.getHttpHeaders=function(a){return null==a&&(a={}),i.diagnostics._getHttpHeaders(a),i.authorization&&(i.authorization._getIsAuthorized()&&i.authorization._getIsAnonymous()?i.authorization._getAnonymousHttpHeaders(a):i.authorization._getHttpHeaders(a)),a},this.getAuthenticationTypeVariable=function(){return u},this.setAuthenticationTypeVariable=function(a){u=a},this.getAuthenticationType=function(){return u},this.setAuthenticationType=function(a){var b=e.validateConfiguration(a);if(i.authorization=null,!i._config.authorization.hasOwnProperty(b))throw f.Exception("No Authentication Type called "+a+" is defined in MobileBackendManager.config \ncheck MobileBackendManager.config in authorization object for the following objects:\n"+k.BASIC+"\n"+k.OAUTH+"\n"+k.FACEBOOK+"\n"+k.TOKEN+"\n"+k.SSO);return i.authorization&&i.authorization._getIsAuthorized()&&i.authorization.logout(),b===k.BASIC?(i.authorization=new l(i._config.authorization.basicAuth,i,i._config.applicationKey,e,d,f),f.info("Your Authentication type: "+b),u=b):b===k.OAUTH?(i.authorization=new m(i._config.authorization.oAuth,i,i._config.applicationKey,e,d,f),f.info("Your Authentication type: "+b),u=b):b===k.FACEBOOK?(i.authorization=new n(i._config.authorization.facebookAuth,i,i._config.applicationKey,e,d,f),f.info("Your Authentication type: "+b),u=b):b===k.SSO?(i.authorization=new o(i._config.authorization.ssoAuth,i,i._config.applicationKey,e,d,f),f.info("Your Authentication type: "+b),u=b):b===k.TOKEN&&(i.authorization=new p(i._config.authorization.tokenAuth,i,i._config.applicationKey,e,d,f),f.info("Your Authentication type: "+b),u=b),i.authorization},this.loadAppConfig=function(a,b){function c(b){return a&&a(b.statusCode,b.data),b}function e(a){return null==b?Promise.reject(a):void b(a.statusCode,a.data)}function g(){function a(a){return f.error("App config download failed! with status code: "+a.statusCode),Promise.reject(a)}var b=i.getHttpHeaders();return b["Content-Type"]="application/json",d.invokeService({method:"GET",url:i.getPlatformUrl("appconfig/client"),headers:b}).catch(a)}return i.authorization._getIsAuthorized()?g().then(c,e):i.authorization.authenticateAnonymous().then(g).then(c,e)}}function u(b,c,d){function e(a){var c=null;if(a.sync&&a.syncExpress)return b.error("WARNING, configuration contains two types synchronisation, please choose one of those types, switch caching off"),void(d.options.off=!0);if(a.sync)c=a.sync,d.options.module=new d.MCSHandler;else{if(!a.syncExpress)return b.verbose("WARNING, missing synchronization configuration, switch caching off"),void(d.options.off=!0);c=a.syncExpress;var e=a.syncExpress.handler&&"OracleRestHandler"===a.syncExpress.handler;d.options.module=e?new d.OracleRestHandler:new d.RequestHandler}d.options.off=!1;var g={default:{conflictResolutionPolicy:"CLIENT_WINS",expirationPolicy:"NEVER_EXPIRE",expireAfter:600,evictionPolicy:"MANUAL_EVICTION",fetchPolicy:"FETCH_FROM_SERVICE_IF_ONLINE",updatePolicy:"QUEUE_IF_OFFLINE",noCache:!1},periodicRefreshInterval:c.backgroundRefreshPolicy||120,policies:[]},h=c.policies;for(var i in h)if(h.hasOwnProperty(i)){var j=h[i];j?g.policies.push(f(j)):b.error("WARNING, the "+j+"policy was not found in accepted policies.")}d.options.Policies=g,d.options.dbFirst=!1,d.options.maxSyncAttempts=1,d.options.autoRemoveAfterReachMaxAttemps=!0}function f(a){var c={};c.path=a.path;for(var d in a)if(a.hasOwnProperty(d)&&"path"!==d){var e=g[d];e?void 0===e[a[d]]?b.error("WARNING, the "+d+" policy value "+a[d]+" was not found in accepted policy values."):c[e.persistencePropertyName]=e[a[d]]:b.error("WARNING, the "+d+" policy was not found in accepted policies.")}return c}var g={fetchPolicy:{persistencePropertyName:"fetchPolicy",FETCH_FROM_CACHE_SCHEDULE_REFRESH:"FETCH_FROM_CACHE_SCHEDULE_REFRESH",FETCH_FROM_SERVICE_IF_ONLINE:"FETCH_FROM_SERVICE_IF_ONLINE",FETCH_FROM_CACHE:"FETCH_FROM_CACHE",FETCH_FROM_SERVICE:"FETCH_FROM_SERVICE",FETCH_FROM_SERVICE_ON_CACHE_MISS:"FETCH_FROM_SERVICE_ON_CACHE_MISS",FETCH_FROM_SERVICE_ON_CACHE_MISS_OR_EXPIRY:"FETCH_FROM_SERVICE_ON_CACHE_MISS_OR_EXPIRY",
FETCH_WITH_REFRESH:"FETCH_WITH_REFRESH"},evictionPolicy:{persistencePropertyName:"evictionPolicy",EVICT_ON_EXPIRY_AT_STARTUP:"EVICT_ON_EXPIRY_AT_STARTUP",MANUAL_EVICTION:"MANUAL_EVICTION"},expirationPolicy:{persistencePropertyName:"expirationPolicy",EXPIRE_ON_RESTART:"EXPIRE_ON_RESTART",EXPIRE_AFTER:"EXPIRE_AFTER",NEVER_EXPIRE:"NEVER_EXPIRE"},updatePolicy:{persistencePropertyName:"updatePolicy",QUEUE_IF_OFFLINE:"QUEUE_IF_OFFLINE",UPDATE_IF_ONLINE:"UPDATE_IF_ONLINE"},refreshPolicy:{persistencePropertyName:"refreshPolicy",PeriodicallyRefreshExpiredResource:""},conflictResolutionPolicy:{persistencePropertyName:"conflictResolutionPolicy",SERVER_WINS:"SERVER_WINS",PRESERVE_CONFLICT:"PRESERVE_CONFLICT",CLIENT_WINS:"CLIENT_WINS"},noCache:{persistencePropertyName:"noCache",false:!1,true:!0}},i=null,j={};if(d){var k=d.options.isOnline,l=!1;d.options.isOnline=function(){return l===!1?k():!l},this._setOfflineMode=function(a){l="boolean"!=typeof a||a}}this.platform=null,Object.defineProperty(this,"_config",{get:function(){return i}}),this.returnMobileBackend=function(d,e){return a.cordova?(this.platform=new CordovaPlatform(this,b,c),b.info("The Cordova platform is set!")):(this.platform=new h(this,b,c),b.info("The Browser platform is set!")),this.setConfig(e),b.info("The config has been set and now it has the backend defined in the config as the point of entry for the rest of the functions you need to call."),this.getMobileBackend(d)},this.getMobileBackend=function(a){if(!this.platform)return b.error("Platform was not initialized, please initialize mcs.mobileBackendManager.platform"),null;if(!i)return b.error("Mobile Backend Manager was not configured, please set config by mcs.mobileBackendManager.setConfig method"),null;if(a=c.validateConfiguration(a),null!=j[a])return j[a];if(i.mobileBackends[a]){var e=new t(this,a,i.mobileBackends[a],this.platform,c,b,d);return j[a]=e,e}return b.error('No mobile backend called " + name + " is defined in MobileBackendManager.config'),null},this.setConfig=function(a){null!=a.logLevel&&(b.logLevel=a.logLevel),i=a,j={},d?e(a):(a.sync||a.syncExpress)&&b.verbose("WARNING, sync script was not included on page, switch caching off")}}function v(a,b,c,d){c=c||W._utils,d=d||W.mobileBackendManager.platform;var e=c.HEADERS,f=a._getBackend(),g=a,h=null;b&&(this.id=b.id,this.name=b.name,this.contentLength=b.contentLength,this.contentType=b.contentType,this._eTag=b.eTag,this.createdBy=b.createdBy,this.createdOn=b.createdOn,this.modifiedBy=b.modifiedBy,this.modifiedOn=b.modifiedOn),this.getPayload=function(){return h},this.setPayload=function(a){h=a},this.getstorageCollection=function(){return g},this.getStorage=function(){return g._storage},this.loadPayload=function(a,b){h=a,this.contentType=b,this.contentType==c.ACCEPT_TYPES.TEXT_PLAIN?"string"==typeof h&&(h=a):this.contentType==c.ACCEPT_TYPES.APPLICATION_JSON&&("string"==typeof h?h=a:"object"==typeof h&&(h=JSON.stringify(a))),this.contentLength=h.length},this.setDisplayName=function(a){this.name=a},this.getDisplayName=function(){return this.name},this.readPayload=function(a,b,h){function i(b){return l.setPayload(b.data),l.name=decodeURI(b.headers[e.ORACLE_MOBILE_NAME]),l._eTag=b.headers[e.E_TAG],l.contentLength=b.data.size,l.contentType=b.headers[e.CONTENT_TYPE],l.createdBy=b.headers[e.ORACLE_MOBILE_CREATED_BY],l.createdOn=b.headers[e.ORACLE_MOBILE_CREATED_ON],l.modifiedBy=b.headers[e.ORACLE_MOBILE_MODIFIED_BY],l.modifiedOn=b.headers[e.ORACLE_MOBILE_MODIFIED_ON],a&&"function"==typeof a&&a(l),l}function j(a){return b?void b(a.statusCode,a.data):Promise.reject(a)}var k=this.getPayload();if(k)return a&&"function"==typeof a&&a(k),Promise.resolve(k);"function"!=typeof a&&(h=a);var l=this,m=f.getHttpHeaders({}),n="storage/collections/"+g.id+"/objects/"+this.id;return null!=g.userId&&g.getUserIsolated()&&(n+="?user="+g.userId),d.invokeService({method:c.HTTP_METHODS.GET,url:f.getPlatformUrl(n),headers:m,responseType:h||"blob"}).then(i,j)}}function w(a,b,d,e,f,g,h){var i,j=f.HEADERS,k=f.ACCEPT_TYPES.APPLICATION_JSON,l=f.HTTP_METHODS,m=e,n=e.storage,o=f.validateConfiguration(b),p=this;this._getBackend=function(){return m},this.getUserIsolated=function(){return i?i.userIsolated:d},this.getStorage=function(){return n},this.getUserId=function(){return o},this.getData=function(){return i},this.id=f.validateConfiguration(a),this.description=i?i.description:void 0,this.getDescription=function(){return i?i.description:void g.warn("Collection metadata was not loaded yet, please use StorageCollection.loadMetadata to load metadata.")},this.loadMetadata=function(){function a(a){return i=a.data,b.description=a.data.description,b}var b=this,c=m.getHttpHeaders({});return c[f.HEADERS.ACCEPT]=f.ACCEPT_TYPES.APPLICATION_JSON,h.invokeService({method:f.HTTP_METHODS.GET,url:m.getPlatformUrl("storage/collections/"+b.id),headers:c}).then(a)},this.getObjects=function(a,b,c,d,e){function i(a){for(var b=[],c=a.data,e=0;e<c.items.length;e++)b[b.length]=new v(p,c.items[e],f,h);return d&&d(b),b}function n(a){return e?void e(a.statusCode,a.data):Promise.reject(a)}var o=m.getHttpHeaders({});o[j.ACCEPT]=k,"function"==typeof c&&(g.warn("getObjects method without allObjects parameter is deprecated in next version, please add allObjects parameter."),e=d,d=c,c=!1);var q="storage/collections/"+p.id+"/objects";return null!=a&&(q+=q.indexOf("?")==-1?"?":"&",q+="offset="+a),null!=b&&(q+=q.indexOf("?")==-1?"?":"&",q+="limit="+b),p.getUserIsolated()&&c?(q+=q.indexOf("?")==-1?"?":"&",q+="user=*"):p.getUserIsolated()&&null!=p.getUserId()&&(q+=q.indexOf("?")==-1?"?":"&",q+="user="+p.getUserId()),h.invokeService({method:l.GET,url:m.getPlatformUrl(q),headers:o}).then(i,n)},this.getObject=function(a,b,c,d){function e(){return b&&"function"==typeof b&&b(i),i}function g(a){return c?void c(a.statusCode,a.data):Promise.reject(a)}"function"!=typeof b&&(d=b);var i=new v(this,m,f,h);return i.id=a,i.readPayload(d).then(e,g)},this.postObject=function(a,b,c){return this._postOrPutStorageObject(a,!0,b,c)},this.putObject=function(a,b,c){return this._postOrPutStorageObject(a,!1,b,c)},this._postOrPutStorageObject=function(a,b,d,e){function g(a){var b=new v(p,a.data,f,h);return d&&d(a.statusCode,b),new c(a.statusCode,b)}function i(a){return e?void e(a.statusCode,a.data):Promise.reject(a)}var k=m.getHttpHeaders();k[j.ORACLE_MOBILE_NAME]=encodeURI(a.getDisplayName()),k[j.CONTENT_TYPE]=a.contentType;var n="storage/collections/"+p.id+"/objects";return b||(n+="/"+a.id,null!=a._eTag&&(k[j.IF_MATCH]=a._eTag)),p.getUserIsolated()&&null!=p.getUserId()&&(n+="?user="+p.getUserId()),h.invokeService({method:b?l.POST:l.PUT,url:m.getPlatformUrl(n),headers:k,data:a.getPayload()}).then(g,i)},this.contains=function(a,b,c){function d(a){return b&&b(a.statusCode,a.data),a}function e(a){return c?void c(a.statusCode,a.data):Promise.reject(a)}var f=m.getHttpHeaders({}),g="storage/collections/"+p.id+"/objects/"+a;return p.getUserIsolated()&&null!=p.getUserId()&&(g+="?user="+p.getUserId()),h.invokeService({method:l.HEAD,url:m.getPlatformUrl(g),headers:f}).then(d,e)},this.deleteObject=function(a,b,c){function d(a){return b&&b(a.statusCode,a.data),a}function e(a){return c?void c(a.statusCode,a.data):Promise.reject(a)}var f=m.getHttpHeaders({});f[j.IF_MATCH]="*";var g="storage/collections/"+p.id+"/objects/"+a;return p.getUserIsolated()&&null!=p.getUserId()&&(g+="?user="+p.getUserId()),h.invokeService({method:l.DELETE,url:m.getPlatformUrl(g),headers:f}).then(d,e)}}function x(a,b,c,d){var e=a;this.getCollection=function(a,f,g,h,i,j){function k(a){return i&&i(a),a}function l(a){return j?void j(a.statusCode,a.data):Promise.reject(a)}"function"==typeof g&&(j=h,i=g,h=!1,g=void 0);var m=new w(a,b.validateConfiguration(f),g,e,b,d,c);return h?Promise.resolve(m).then(k,l):m.loadMetadata().then(k,l)}}function y(a,b,c,d){var e=a;this.getDevicePlatform=function(){var a="iPhone"==navigator.userAgent.match(/iPhone/i)?"iPhone":"iPad"==navigator.userAgent.match(/iPad/i)?"iPad":"iPod"==navigator.userAgent.match(/iPod/i)?"iPod":"Android"==navigator.userAgent.match(/Android/i)?"Android":"null";return"i"==a.substring(0,1)?a="iOS":"A"==a.substring(0,1)&&(a="Android"),a.toUpperCase()},this.registerForNotifications=function(a,f,g,h,i){function j(a){return d.info("Device registered for push notifications. "+a.statusCode),h&&h(a.statusCode),a}function k(a){return d.error("Device registration for push notifications failed! "+a.statusCode+":"+JSON.stringify(a)),i?void i(a.statusCode,a.data):Promise.reject(a)}var l=this,m=null,n=e.getHttpHeaders({});return n[b.HEADERS.CONTENT_TYPE]=b.ACCEPT_TYPES.APPLICATION_JSON,m="undefined"==typeof device?{notificationToken:a,mobileClient:{id:f,version:g,platform:l.getDevicePlatform()}}:{notificationToken:a,mobileClient:{id:f,version:g,platform:device.platform.toUpperCase()}},c.invokeService({method:b.HTTP_METHODS.POST,url:e.getPlatformUrl("devices/register"),headers:n,data:JSON.stringify(m)}).then(j,k)},this.deregisterForNotifications=function(a,f,g,h){function i(a){return d.info("Device deregistered for push notifications succeeded. "+a.statusCode),g&&g(a.statusCode),a}function j(a){return d.error("Device deregistration for push notifications failed! "+a.statusCode),h?void h(a.statusCode,a.data):Promise.reject(a)}var k=this,l=null,m=e.getHttpHeaders({});return m[b.HEADERS.CONTENT_TYPE]=b.ACCEPT_TYPES.APPLICATION_JSON,l="undefined"==typeof device?{notificationToken:a,mobileClient:{id:f,platform:k.getDevicePlatform()}}:{notificationToken:a,mobileClient:{id:f,platform:device.platform.toUpperCase()}},c.invokeService({method:b.HTTP_METHODS.POST,url:e.getPlatformUrl("devices/deregister"),headers:m,data:JSON.stringify(l)}).then(i,j)}}function z(a,b,c,d,e,f){this._persistence=f,this.backend=b;var g={};this.setOfflineMode=a._setOfflineMode,this.isOnline=function(){return f.options.isOnline()},this.purge=function(){for(var a in g)if(g.hasOwnProperty(a)){var b=g[a];for(var c in b)b.hasOwnProperty(c)&&b[c].purge()}},this.openEndpoint=function(a,b){return null==g[a]&&(g[a]={}),null==g[a][b]&&(g[a][b]=new K(this,a,b,d,e)),g[a][b]}}function A(a,b,c,d,e,f){var g=e.HEADERS,h=e.RESOURCE_TYPES,i=f.common;this.apiName=b,this.endpointPath=c,this.resolvingOfflineUpdate=d,this.getHttpHeaders=function(b){var c=a.getHttpHeaders(b);return c[g.ORACLE_MOBILE_SYNC_AGENT]=!0,c},this.getType=function(a,b){var c=V.file,d=a[g.ORACLE_MOBILE_SYNC_RESOURCE_TYPE.toLowerCase()];if(null!=d)d===h.ITEM?c=V.item:d===h.COLLECTION&&(c=V.collection);else if(i.isString(b))try{var e=JSON.parse(b);c=i.isArray(e)?V.collection:V.item}catch(f){c=V.file}return c},this.getUri=function(a,b){var c=a&&a.headers?a.headers[g.LOCATION.toLowerCase()]:null;if(null!=c)return"/"+c;var d=null;if(a.data&&(d="string"==typeof a.data?""!=a.data?JSON.parse(a.data):null:a.data),d&&d[f.options.module.URI_KEY]){var e=d[f.options.module.URI_KEY];return delete d[f.options.module.URI_KEY],e}return f.options.parseURL(b).path},this.createResource=function(a,b,c,d,e,f,j){var k=response.headers[g.LOCATION.toLowerCase()];k=null!=k?"/"+k:b;var l=V.file,m=e[g.ORACLE_MOBILE_SYNC_RESOURCE_TYPE.toLowerCase()];if(null!=m)m==h.ITEM?l=V.item:m==h.COLLECTION&&(l=V.collection);else if(i.isString(j))try{var n=JSON.parse(j);l=i.isArray(n)?V.collection:V.item}catch(o){l=V.file}return null}}function B(a,b,c,d,e,f){A.call(this,a,b,c,!1,e,f),this.performRequest=function(a,b,c){function f(b){return{uri:g.getUri(b,a),data:b.data}}var g=this,h=g.getHttpHeaders(b);return d.invokeService({method:e.HTTP_METHODS.GET,url:a,headers:h}).then(f)}}function C(a,b,c,d,e,f){A.call(this,a,b,c,!0,e,f),this.performRequest=function(a,b,c){function f(b){return{uri:g.getUri(b,a),data:b.data}}var g=this,h=g.getHttpHeaders(b);return d.invokeService({method:e.HTTP_METHODS.PUT,url:a,headers:h,data:c}).then(f)}}function D(a,b,c,d,e,f){A.call(this,a,b,c,!0,e,f),this.performRequest=function(a,b,c){function f(b){return{uri:g.getUri(b,a),data:b.data}}var g=this,h=g.getHttpHeaders(b);return d.invokeService({method:e.HTTP_METHODS.POST,url:a,headers:h,data:c}).then(f)}}function E(a,b,c,d,e,f){A.call(this,a,b,c,!0,e,f),this.performRequest=function(a,b,c){function f(b){return{uri:g.getUri(b,a),data:b.data}}var g=this,h=g.synchronization.backend.getHttpHeaders(b);return h["Accept-Encoding"]="gzip",h["Oracle-Mobile-Sync-Agent"]=!0,d.invokeService({method:e.HTTP_METHODS.PATCH,url:a,headers:h,data:c}).then(f)}}function F(a,b,c,d,e,f){A.call(this,a,b,c,!0,e,f),this.performRequest=function(a){var b=this,c=b.getHttpHeaders({});return d.invokeService({method:e.HTTP_METHODS.DELETE,url:a,headers:c})}}function G(a,b){if(this.constructor===G)throw new Error("Can't instantiate abstract class!");var c=b,d=a;this._getEndpoint=function(){return d},this._getMcsId=function(){return c?c.substring(c.lastIndexOf("/")+1,c.length):null},this._getMcsURI=function(){return c}}function H(a,b){var c=a,d=!1,e=-1,f=-1,g=!1,h={},i={};this.execute=function(){return c._executeFetchObjects(i,h,g,e,f,d)}}function I(a,b){G.call(this,a,b),this._type=V.item}function J(a,b){G.call(this,a,b),this._type=V.item;var c=[];this.initialize=function(a){for(var b in a)if(a.hasOwnProperty(b)){var d=a[b];c.push(d)}return this},this.getLength=function(){return c.length},this.getItem=function(a){return c[a]},this.all=function(){return c},this.forEach=function(a){c.forEach(a)}}function K(a,c,d,e,f){var g=this,h=e.HEADERS,i=e.ACCEPT_TYPES.APPLICATION_JSON,j=a._persistence;this._backend=a.backend,this.synchronization=a,this.apiName=c,this.endpointPath=d,this.purge=function(){j.options.module.flush(g._backend.getCustomCodeUrl(g.apiName+"/"+g.endpointPath))},this.createObject=function(a){return a=a||{},a.__proto__=new I(this,null),a},this.fetchObject=function(a,c){function d(a){if(a.data&&""!==a.data){var c=a.data;return"string"==typeof c&&(c=""!=c?JSON.parse(c):null),c.__proto__=new I(m,a.uri),c}return Promise.reject(new b(404,"Object not found in cache."))}var k=g.apiName;g.endpointPath&&""!=g.endpointPath&&(k+="/"+g.endpointPath),a&&""!=a&&(k+="/"+a),k=g._backend.getCustomCodeUrl(k);var l=new B(g._backend,g.apiName,g.endpointPath,f,e,j),m=this,n={};return n[h.ACCEPT]=i,l.performRequest(k,n,c).then(d)},this._save=function(a,b){function c(b){var c=b.data;return"string"==typeof c&&(c=""!=c?JSON.parse(c):null),d._updateMobileObject(a,c),a.__proto__=new I(d,b.uri),a}var d=this,k=!a._getMcsURI(),l=k?g._backend.getCustomCodeUrl(g.apiName+"/"+g.endpointPath):g._backend._baseUrl+a._getMcsURI(),m=k?new D(g._backend,g.apiName,g.endpointPath,f,e,j):new C(g._backend,g.apiName,g.endpointPath,f,e,j),n=JSON.stringify(a),o={};return o[h.ACCEPT]=i,o[h.CONTENT_TYPE]=i,m.performRequest(l,o,n).then(c)},this._delete=function(a,b){function c(){h._updateMobileObject(a._syncResource),a._syncResource=null}var d=new F(g._backend,g.apiName,g.endpointPath,f,e,j),h=this,i=g._backend._baseUrl+a._getMcsURI();return d.performRequest(i,{}).then(c)},this._reload=function(a,b,c,d,e,f){var h=this;return null==b._syncResource?(a?(b.data=null,b.contentType=null):h._updateMobileObject(b,{}),void(e&&e())):void(1==c?g.synchronization._persistenceManager.clearOfflineState(b.url,function(){h._reloadFromCacheOrService(a,b,d,e,f)},f):h._reloadFromCacheOrService(a,b,d,e,f))},this._reloadFromCacheOrService=function(a,b,c,d,k){var l=this;if(1!=c)return void g.synchronization._persistenceManager.loadResource(b.url,function(c){c.loadCachedData(function(e){a?(b.data=e,b.contentType=c.responseHeaders[h.CONTENT_TYPE.toLowerCase()]):(l._updateMobileObject(b,e),b.__proto__=new I(l,c),b._initialize()),d&&d(b)},k)},k);var m=new B(g._backend,g.apiName,g.endpointPath,f,e,j),n={};a||(n[h.ACCEPT]=i);var o=null;m.performRequest(url,n,!0,o,function(c){c.loadCachedData(function(e){a?(b._syncResource=c,b.data=e,b.contentType=c.responseHeaders[h.CONTENT_TYPE.toLowerCase()]):(l._updateMobileObject(b,e),b.__proto__=new I(l,c),b._initialize()),null!=d&&d(mobileObject)},k)},k)},this._updateMobileObject=function(a,b){for(var c in a)a.hasOwnProperty(c)&&delete a[c];for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])},this._executeFetchObjects=function(a,b,c,d,i,j){function k(a){var b=a.data;"string"==typeof b&&(b=""!=b?JSON.parse(b):null);var c=[];for(var d in b.items)if(b.items.hasOwnProperty(d)){var e=b.items[d],f="/"+b.uris[d];e.__proto__=new I(l,f),c.push(e)}return new J(l,null).initialize(c)}var l=this,m=g._backend.getHttpHeaders(a);m[h.ORACLE_MOBILE_SYNC_AGENT]=!0;var n={method:e.HTTP_METHODS.GET,url:g._backend.getCustomCodeUrl(g.apiName+"/"+g.endpointPath),headers:m};return f.invokeService(n).then(k)}}var L={offline:0,unrestricted:1,restricted:2,critical:3},M={ERROR:1,INFO:2,VERBOSE:3},N={basicAuth:"basicAuth",oAuth:"oAuth",facebookAuth:"facebookAuth",ssoAuth:"ssoAuth"};d.prototype.Exception=function(a){this.message=a,this.name="Exception",console.error(this.name+" : "+this.message)},d.prototype.debug=function(a,b){console.log(a+" "+b)},d.prototype.error=function(a,b){this.log(M.ERROR,a,!1,b)},d.prototype.info=function(a,b){this.log(M.INFO,a,!1,b)},d.prototype.verbose=function(a,b){this.log(M.VERBOSE,a,!1,b)},d.prototype.warn=function(a,b){this.log(M.ERROR,a,!0,b)},d.prototype.log=function(a,b,c,d){this.logLevel>=a&&(this.logLevel===M.ERROR?c?console.warn(b,d):console.error(b,d):console.log(b,d))};var O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",P={ORACLE_MOBILE_DIAGNOSTIC_SESSION_ID:"Oracle-Mobile-DIAGNOSTIC-SESSION-ID",ORACLE_MOBILE_DEVICE_ID:"Oracle-Mobile-DEVICE-ID",ORACLE_MOBILE_CLIENT_REQUEST_TIME:"Oracle-Mobile-CLIENT-REQUEST-TIME",ORACLE_MOBILE_NAME:"Oracle-Mobile-Name",ORACLE_MOBILE_CREATED_BY:"Oracle-Mobile-Created-By",ORACLE_MOBILE_CREATED_ON:"Oracle-Mobile-Created-On",ORACLE_MOBILE_MODIFIED_BY:"Oracle-Mobile-Modified-By",ORACLE_MOBILE_MODIFIED_ON:"Oracle-Mobile-Modified-On",ORACLE_MOBILE_SYNC_RESOURCE_TYPE:"Oracle-Mobile-Sync-Resource-Type",ORACLE_MOBILE_SYNC_AGENT:"Oracle-Mobile-Sync-Agent",LOCATION:"Location",ORACLE_MOBILE_APPLICATION_KEY:"Oracle-Mobile-Application-Key",ORACLE_MOBILE_BACKEND_ID:"Oracle-Mobile-Backend-Id",ORACLE_MOBILE_SOCIAL_IDENTITY_PROVIDER:"Oracle-Mobile-Social-Identity-Provider",ORACLE_MOBILE_SOCIAL_ACCESS_TOKEN:"Oracle-Mobile-Social-Access-Token",ACCEPT:"Accept",CONTENT_TYPE:"Content-Type",E_TAG:"ETag",IF_MATCH:"If-Match",AUTHORIZATION:"Authorization",X_USER_IDENTITY_DOMAIN_NAME:"X-USER-IDENTITY-DOMAIN-NAME"},Q={APPLICATION_JSON:"application/json",TEXT_PLAIN:"text/plain"},R={GET:"GET",PUT:"PUT",PATCH:"PATCH",POST:"POST",DELETE:"DELETE",HEAD:"HEAD"},S={ITEM:"item",COLLECTION:"collection",FILE:"file"},T={BASIC:"basicAuth",OAUTH:"oAuth",SSO:"ssoAuth",FACEBOOK:"facebookAuth",TOKEN:"tokenAuth"};f.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},f.prototype.validateConfiguration=function(a){var b=a;return/\s/.test(b)&&void 0!=b&&(b=e(a)),b},f.prototype.encodeBase64=function(a){var b,c,d,e,f,g="",h="",i="",j=0;do b=a.charCodeAt(j++),c=a.charCodeAt(j++),h=a.charCodeAt(j++),d=b>>2,e=(3&b)<<4|c>>4,f=(15&c)<<2|h>>6,i=63&h,isNaN(c)?f=i=64:isNaN(h)&&(i=64),g=g+O.charAt(d)+O.charAt(e)+O.charAt(f)+O.charAt(i),b=c=h="",d=e=f=i="";while(j<a.length);return g},f.prototype.decodeBase64=function(a){var b,c,d,e,f,g="",h="",i="",j=0,k=/[^A-Za-z0-9\+\/\=]/g;if(k.exec(a))return null;a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do d=O.indexOf(a.charAt(j++)),e=O.indexOf(a.charAt(j++)),f=O.indexOf(a.charAt(j++)),i=O.indexOf(a.charAt(j++)),b=d<<2|e>>4,c=(15&e)<<4|f>>2,h=(3&f)<<6|i,g+=String.fromCharCode(b),64!=f&&(g+=String.fromCharCode(c)),64!=i&&(g+=String.fromCharCode(h)),b=c=h="",d=e=f=i="";while(j<a.length);return g},f.prototype.hasValue=function(a,b,c){return a.hasOwnProperty(b)&&a[b]===c},f.prototype.isEquivalentURL=function(a,b){return 0===a.indexOf("https")&&0===b.indexOf("https")?(a=443===this.getPort(a)?a.replace(":443",""):a,b=443===this.getPort(b)?b.replace(":443",""):b):a.indexOf("https")===-1&&b.indexOf("https")===-1&&(a=80===this.getPort(a)?a.replace(":80",""):a,b=80===this.getPort(b)?b.replace(":80",""):b),0===a.indexOf(b)},f.prototype.getPort=function(a){var b=a.indexOf(":",7),c=a.indexOf("/",b);b>0&&c==-1&&(c=a.length);var d=a.substr(b+1,c-b-1);return d&&!isNaN(1*d)?1*d:-1},f.prototype.parseHeaders=function(a){var b={};if(!a)return b;for(var c=a.split("\r\n"),d=0,e=c.length;d<e;d++){var f=c[d],g=f.indexOf(": ");g>0&&(b[f.substring(0,g)]=f.substring(g+2))}return b},g.prototype.getGPSLocation=function(){return{latitude:null,longitude:null}},g.prototype.getDeviceInformation=function(){return{model:"<unknown>",manufacturer:"<unknown>",osName:"<unknown>",osVersion:"<unknown>",osBuild:"<unknown>",carrier:"<unknown>"}},g.prototype.invokeService=function(a){throw Error("invokeService() not implemented in Platform!")},g.prototype.validateCachedCredentials=function(a,b){return!1},g.prototype.cacheCredentials=function(a,b){throw Error("cacheCredentials() not implemented in Platform!")},h.prototype=Object.create(g.prototype),h.prototype.constructor=h,k.prototype.isTokenValid=function(){throw new Error("Abstract method!")},k.prototype.authenticateAnonymous=function(a,b){throw new Error("Abstract method!")},k.prototype.authenticate=function(){throw new Error("Abstract method!")},k.prototype.refreshToken=function(a,b){throw new Error("Abstract method!")},k.prototype.logout=function(){throw new Error("Abstract method!")},k.prototype._anonymousTokenResponseConverter=function(a){throw new Error("Abstract method!")},k.prototype._getHttpHeaders=function(a){throw new Error("Abstract method!")},l.prototype=Object.create(k.prototype),l.prototype.constructor=l,m.prototype=Object.create(k.prototype),m.prototype.constructor=m;var U=function(a){var b=["cordova-plugin-inappbrowser","org.apache.cordova.inappbrowser"];return b.some(function(b){return a.hasOwnProperty(b)})};n.prototype=Object.create(k.prototype),n.prototype.constructor=n,o.prototype=Object.create(k.prototype),o.prototype.constructor=o,p.prototype=Object.create(k.prototype),p.prototype.constructor=p,p.prototype._inflate=function(a){var b=atob(a),c=b.split("").map(function(a){return a.charCodeAt(0)}),d=pako.inflate(c);return String.fromCharCode.apply(null,d)},p.prototype._deflate=function(a){var b=a.split("").map(function(a){return a.charCodeAt(0)}),c=pako.gzip(b);return btoa(String.fromCharCode.apply(null,c))},p.prototype._getXmlTokenExpiryDate=function(a){var b=a.indexOf('NotOnOrAfter="');if(b===-1)return null;b+=14;var c=a.indexOf('"',b)-b;return a.substr(b,c)},p.prototype._parseDate=function(a){var b=a.split("T"),c=b[0].split("-"),d=b[1].split(":");return new Date(c[0],c[1],c[2],d[0],d[1])},p.prototype._anonymousTokenResponseConverter=function(a){return{orgResponse:a.orgResponse,anonymousAccessToken:a.orgResponse.data.access_token}},z.prototype._run=function(a){return persistence.process.run(a)},z.prototype._runWithoutReadInBackground=function(a){return persistence.process.runWithoutReadInBackground(a)},B.prototype=Object.create(A.prototype),B.prototype.constructor=B,C.prototype=Object.create(A.prototype),C.prototype.constructor=C,D.prototype=Object.create(A.prototype),D.prototype.constructor=D,E.prototype=Object.create(A.prototype),E.prototype.constructor=E,F.prototype=Object.create(A.prototype),F.prototype.constructor=F,I.prototype=Object.create(G.prototype),I.prototype.constructor=I,I.prototype.save=function(a){return this._getEndpoint()._save(this,a)},I.prototype.delete=function(a){return this._getEndpoint()._delete(this,a)},J.prototype=Object.create(G.prototype),J.prototype.constructor=J,K.prototype.fetchObjects=function(){return new H(this)};var V={item:0,collection:1,file:2},W={};W._utils=new f,W._logger=new d;var X=a.mcs&&a.mcs._sync?a.mcs._sync:void 0;W.mobileBackendManager=new u(W._logger,W._utils,X),W.mobileBackendManager.platform=new h(W.mobileBackendManager,W._logger,W._utils),W.MobileBackendManager=W.mobileBackendManager,W.AnalyticsEvent=i,W.BrowserPlatform=h,"undefined"!=typeof CordovaPlatform&&(W.CordovaPlatform=CordovaPlatform),W.NetworkResponse=b,W.NetworkStorageObject=c,W.StorageObject=v,W.LOG_LEVEL=M,W.AUTHORIZATION_TYPES=N,W.logLevel=M,"function"==typeof define&&define.amd?define([],W):"object"==typeof exports?module.exports=W:a.mcs=W}(this);